<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>à¹à¸Šà¸—à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸™à¸ªà¸³à¸„à¸±à¸ â¤ï¸</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Mitr', sans-serif;
      background-color: #fce4ec;
      background-image: radial-gradient(#f8bbd0 1px, transparent 1px);
      background-size: 15px 15px;
    }
    /* Style for the chat messages container to hold the background image */
    #chat-messages {
      background-color: #ffffff; /* Default background for the chat area */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: background-image 0.3s ease-in-out; /* Smooth transition for background image */
      flex-1 p-4 overflow-y-auto space-y-4; /* Existing Tailwind classes */
    }
    #chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    #chat-messages::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    #chat-messages::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }
    #chat-messages::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-100">

  <div class="w-full max-w-md h-[90vh] md:h-[80vh] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden border-4 border-white">
    <header class="bg-pink-400 text-white p-4 flex items-center justify-between shadow-md">
      <h1 class="text-xl font-semibold"> ğ‘´ğ’š ğ’ğ’Šğ’ ğ’ƒğ’ğ’š â™¡</h1>
      <label for="upload-bg-input" class="cursor-pointer bg-pink-500 hover:bg-pink-600 text-white rounded-full p-2 w-10 h-10 flex items-center justify-center transition shadow-md hover:shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
        </svg>
        <input type="file" id="upload-bg-input" accept="image/*" class="hidden">
      </label>
    </header>

    <main id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-4"></main>

    <div id="typing-indicator" class="px-4 pb-2 hidden">
      <div class="flex items-center gap-2">
        <img src="bot-avatar.jpg"
             alt="Bot Avatar"
             class="w-8 h-8 rounded-full object-cover flex-shrink-0">
        <div class="text-gray-500 text-sm bg-gray-200 px-3 py-2 rounded-lg">
          à¸à¸³à¸¥à¸±à¸‡à¸à¸´à¸¡à¸à¹Œ...
        </div>
      </div>
    </div>

    <footer class="p-4 bg-white border-t border-gray-200">
      <div class="flex items-center space-x-2">
        <input type="text" id="message-input" placeholder="à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡..." class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-pink-400 transition">
        <button id="send-button" class="bg-pink-500 hover:bg-pink-600 text-white rounded-full p-3 w-12 h-12 flex items-center justify-center transition shadow-md hover:shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const chatMessages = document.getElementById('chat-messages');
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');
      const typingIndicator = document.getElementById('typing-indicator');
      const uploadBgInput = document.getElementById('upload-bg-input');

      // Load background from local storage for the chat messages area
      const savedChatBgImage = localStorage.getItem('chatMessagesBackgroundImage');
      if (savedChatBgImage) {
        chatMessages.style.backgroundImage = `url('${savedChatBgImage}')`;
        chatMessages.style.backgroundSize = 'cover';
        chatMessages.style.backgroundPosition = 'center';
        chatMessages.style.backgroundRepeat = 'no-repeat';
      } else {
        // Default background for chat messages area if none is saved
        chatMessages.style.backgroundImage = 'none'; // No default image, just background-color
      }

      const keywordReplies = {
        'à¸„à¸´à¸”à¸–à¸¶à¸‡': 'à¸„à¸´à¸”à¸–à¸¶à¸‡à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™à¸„à¹‰à¸²à¸š ğŸ¥°',
        'à¹€à¸«à¸™à¸·à¹ˆà¸­à¸¢': 'à¹‚à¸­à¹‹à¹† à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™à¹„à¸£à¸™à¸°à¸„à¸™à¹€à¸à¹ˆà¸‡ à¸à¸­à¸”à¹† à¸™à¸°à¸„à¸° ',
        'à¸£à¸±à¸': 'à¸£à¸±à¸à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸­à¸µà¸! ğŸ’–',
        'à¸à¸±à¸™à¸”à¸µ': 'à¸à¸±à¸™à¸”à¸µà¸„à¹ˆà¸²à¸²à¸² à¸‚à¸­à¹ƒà¸«à¹‰à¸à¸±à¸™à¸–à¸¶à¸‡à¹€à¸„à¹‰à¸²à¸™à¸° ğŸ˜´',
        'à¸—à¸³à¹„à¸£': 'à¸„à¸´à¸”à¸–à¸¶à¸‡à¹€à¸˜à¸­à¸­à¸¢à¸¹à¹ˆà¹„à¸‡à¸„à¹‰à¸²à¸šà¸šà¸š',
        'à¸šà¹‰à¸²': 'à¸šà¹‰à¸²à¸à¹‡à¸£à¸±à¸à¸™à¹‰à¸²à¸²à¸²à¸²~'
      };

      // à¹€à¸à¸´à¹ˆà¸¡ object à¸ªà¸³à¸«à¸£à¸±à¸š Voice Message Replies
      const voiceReplies = {
        'à¸šà¸µà¹‹': 'audio/babe.mp3', // à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸²à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¸Šà¸·à¹ˆà¸­ hello.mp3 à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ audio
        'à¸«à¸´à¸§': 'audio/hungry.mp3', // à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸²à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¸Šà¸·à¹ˆà¸­ hungry.mp3
        'à¸ˆà¸¸à¹Šà¸š': 'audio/kiss.mp3'    // à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸²à¸¡à¸µà¹„à¸Ÿà¸¥à¹Œà¹€à¸ªà¸µà¸¢à¸‡à¸Šà¸·à¹ˆà¸­ kiss.mp3
      };

      const autoReplies = [
        "à¸ªà¸¹à¹‰à¹† à¸™à¸°à¸„à¸°à¸„à¸™à¹€à¸à¹ˆà¸‡ âœŒï¸",
        "à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¹„à¸‡à¸šà¹‰à¸²à¸‡à¸„à¸°?",
        "à¸¡à¸µà¸­à¸°à¹„à¸£à¹ƒà¸«à¹‰à¸Šà¹ˆà¸§à¸¢à¸¡à¸±à¹‰à¸¢à¸„à¸°?",
        "à¸—à¸²à¸™à¸‚à¹‰à¸²à¸§à¸£à¸¶à¸¢à¸±à¸‡à¸„à¹‰à¸²à¸š ğŸš",
        "à¹€à¸à¹ˆà¸‡à¸¡à¸²à¸à¹† à¹€à¸¥à¸¢à¸„à¹ˆà¸°à¸§à¸±à¸™à¸™à¸µà¹‰ ğŸ‘",
        "à¸à¸±à¸à¸œà¹ˆà¸­à¸™à¹€à¸¢à¸­à¸°à¹† à¸™à¹‰à¸²à¸²à¸²",
        "à¸ªà¹ˆà¸‡à¸à¸³à¸¥à¸±à¸‡à¹ƒà¸ˆà¹ƒà¸«à¹‰à¸£à¸±à¸§à¹† à¹€à¸¥à¸¢à¸¢à¸¢ ğŸ’•",
        "à¸§à¹ˆà¸²à¹„à¸‡à¸„à¸°à¸—à¸µà¹ˆà¸£à¸±à¸"
      ];

      function addMessage(content, sender, type = 'text') {
        const messageWrapper = document.createElement('div');
        messageWrapper.className = `flex items-end gap-2 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

        const messageBubble = document.createElement('div');
        messageBubble.className = `max-w-xs md:max-w-sm p-3 rounded-2xl shadow`;

        if (sender === 'user') {
          messageBubble.classList.add('bg-blue-500', 'text-white');
          messageBubble.textContent = content; // User messages are always text
          messageWrapper.appendChild(messageBubble);
        } else { // Bot messages (text or audio)
          const botAvatar = document.createElement('img');
          botAvatar.src = 'bot-avatar.jpg';
          botAvatar.alt = 'Bot Avatar';
          botAvatar.className = 'w-8 h-8 rounded-full object-cover flex-shrink-0';

          messageBubble.classList.add('bg-gray-200', 'text-gray-800');

          if (type === 'audio') {
            const audioPlayer = document.createElement('audio');
            audioPlayer.controls = true; // à¹ƒà¸«à¹‰à¹à¸ªà¸”à¸‡ control à¸‚à¸­à¸‡ Audio (à¹€à¸Šà¹ˆà¸™à¸›à¸¸à¹ˆà¸¡ Play/Pause)
            audioPlayer.src = content;
            messageBubble.appendChild(audioPlayer);

            // Removed audioPlayer.play() to prevent autoplay
            // audioPlayer.oncanplaythrough = () => {
            //     audioPlayer.play().catch(e => console.error("Autoplay failed:", e));
            // };

          } else { // type === 'text'
            messageBubble.textContent = content;
          }

          messageWrapper.appendChild(botAvatar);
          messageWrapper.appendChild(messageBubble);
        }

        chatMessages.appendChild(messageWrapper);
        scrollToBottom();
      }

      function scrollToBottom() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function handleSendMessage() {
        const text = messageInput.value.trim();
        if (text === '') return;

        addMessage(text, 'user');
        messageInput.value = '';

        typingIndicator.classList.remove('hidden');
        setTimeout(() => sendBotReply(text), 1000 + Math.random() * 500);
      }

      function sendBotReply(userMessage) {
        let replyContent = null;
        let replyType = 'text'; // Default reply type

        // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Voice Replies à¸à¹ˆà¸­à¸™
        for (const keyword in voiceReplies) {
          if (userMessage.includes(keyword)) {
            replyContent = voiceReplies[keyword];
            replyType = 'audio';
            break;
          }
        }

        // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ Voice Reply à¹ƒà¸«à¹‰à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Text Replies
        if (!replyContent) {
          for (const keyword in keywordReplies) {
            if (userMessage.includes(keyword)) {
              replyContent = keywordReplies[keyword];
              replyType = 'text';
              break;
            }
          }
        }

        // à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µ Reply à¹ƒà¸«à¹‰à¸ªà¹ˆà¸‡ Auto Reply à¸ªà¸¸à¹ˆà¸¡
        if (!replyContent) {
          const randomIndex = Math.floor(Math.random() * autoReplies.length);
          replyContent = autoReplies[randomIndex];
          replyType = 'text';
        }

        typingIndicator.classList.add('hidden');
        addMessage(replyContent, 'bot', replyType);
      }

      uploadBgInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const imageUrl = e.target.result;
            chatMessages.style.backgroundImage = `url('${imageUrl}')`;
            chatMessages.style.backgroundSize = 'cover';
            chatMessages.style.backgroundPosition = 'center';
            chatMessages.style.backgroundRepeat = 'no-repeat';
            localStorage.setItem('chatMessagesBackgroundImage', imageUrl); // Save the image as a Data URL
          };
          reader.readAsDataURL(file); // Read the image file as a Data URL
        }
      });

      sendButton.addEventListener('click', handleSendMessage);
      messageInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') handleSendMessage();
      });

      setTimeout(() => {
        addMessage('à¸„à¸´à¸”à¸–à¸¶à¸‡à¹€à¸„à¹‰à¸²à¸«à¸£à¸­à¸„à¸°à¸šà¸µà¹‹', 'bot');
      }, 500);
    });
  </script>
</body>
</html>
