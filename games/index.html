<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมของม่อน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #fdf2f8; /* bg-pink-50 */
            background-image: radial-gradient(#fecdd3 1px, transparent 1px);
            background-size: 15px 15px;
            color: #4a5568; /* text-gray-700 */
        }
        .hidden {
            display: none;
        }
        .app-container {
            background-color: #fff0f5; /* Lavender Blush */
            box-shadow: 0 0 40px rgba(219, 39, 119, 0.15);
        }
        
        .card-base {
            border: 2px solid #FBCFE8;
            background: linear-gradient(145deg, #fffafa, #ffe4e6);
            box-shadow: 0 5px 15px rgba(219, 39, 119, 0.1), inset 0 0 5px rgba(255,255,255,0.5);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card-base:not(.bonus-game-card):hover { /* Added :not() to prevent double hover effect on bonus card */
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(219, 39, 119, 0.15), inset 0 0 5px rgba(255,255,255,0.5);
        }

        .btn-base {
            transform: translateY(0);
            transition: transform 0.2s ease, filter 0.2s ease;
        }
        .btn-base:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }
        .btn-base:active {
            transform: translateY(1px);
        }
        
        @keyframes pulsing-glow {
            0%   { box-shadow: 0 0 15px rgba(255, 255, 255, 0.5), 0 0 25px rgba(255, 255, 255, 0.3); }
            50%  { box-shadow: 0 0 25px rgba(255, 255, 255, 0.9), 0 0 50px rgba(255, 255, 255, 0.6); }
            100% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.5), 0 0 25px rgba(255, 255, 255, 0.3); }
        }

        @keyframes animated-rainbow-gradient {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Rainbow border for the main announcement card */
        #bonus-game-section {
            position: relative;
            border: 4px solid transparent;
            background-clip: padding-box; 
            overflow: hidden;
            border-radius: 1.5rem; 
        }

        #bonus-game-section::before {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            z-index: 0; /* Changed to 0 to be behind content */
            margin: -4px; 
            border-radius: inherit; 
            background: linear-gradient(125deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3, #ff2400);
            background-size: 400% 400%;
            animation: animated-rainbow-gradient 10s infinite linear;
        }

        /* Ensure content is on top of the border pseudo-element */
        #bonus-game-section > * {
            position: relative;
            z-index: 1;
        }
        
        .bonus-game-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #be185d; /* text-pink-700 */
            border-bottom: none;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.7);
        }

        /* Styling for the smaller game card that IS the bonus game */
        .game-card.bonus-game {
            border: 3px solid #fff;
            transform: scale(1.05);
            background: linear-gradient(125deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3, #ff2400);
            background-size: 400% 400%;
            animation: 
                pulsing-glow 2.5s infinite ease-in-out,
                animated-rainbow-gradient 10s infinite linear;
        }
        
        .game-card.bonus-game:hover {
            transform: translateY(-5px) scale(1.08);
            animation-play-state: paused;
        }
        
        .game-card.bonus-game h3, .game-card.bonus-game p {
            color: white;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8), 0 0 5px rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body>

    <div id="app-container" class="app-container max-w-md mx-auto min-h-screen p-4">

        <div id="menu-screen">
            <header class="text-center mb-6">
                <h1 class="text-5xl leading-tight font-bold bg-gradient-to-r from-fuchsia-500 to-pink-500 text-transparent bg-clip-text [text-shadow:1px_1px_3px_rgba(219,39,119,0.1)] mb-2">
                    เกมของม่อน
                </h1>
                <p class="text-lg text-pink-500 font-medium mt-1">มาเล่นกันเถอะ!</p>
            </header>

            <div id="bonus-game-section" class="card-base bg-white p-5 rounded-3xl shadow-lg mb-6 hidden">
                <h2 class="bonus-game-header text-2xl font-semibold mb-4 text-center pb-2 flex items-center justify-center">
                    <span class="w-8 h-8 mr-3 flex items-center justify-center text-2xl">✨</span>
                    เกมโบนัสวันนี้ (x2 เหรียญ)
                </h2>
                <div class="text-center text-gray-700 font-semibold text-xl" id="daily-bonus-game-name"></div>
            </div>

            <div class="card-base bg-white p-5 rounded-3xl shadow-lg mb-6">
                <h2 class="text-2xl font-semibold text-gray-600 mb-4 text-center pb-2 border-b border-dashed border-pink-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" /><path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" /></svg>
                    กระเป๋าเงิน
                </h2>
                <div class="flex justify-around items-center pt-2">
                    <div class="text-center">
                        <p class="text-4xl font-bold text-amber-500 flex items-center justify-center">
                            <span id="mon-coin-display">0</span>
                            <img src="mon_coin_icon.png" alt="Mon Coin" class="w-8 h-8 ml-2">
                        </p>
                        <p class="text-sm font-medium text-gray-400">เหรียญม่อน ($)</p>
                    </div>
                    <div class="text-center">
                        <p class="text-4xl font-bold text-emerald-500 flex items-center justify-center">
                            <span id="play-coin-display">0</span>
                            <img src="play_coin_icon.png" alt="Play Coin" class="w-8 h-8 ml-2">
                        </p>
                        <p class="text-sm font-medium text-gray-400">เหรียญเล่นม่อน</p>
                    </div>
                </div>
            </div>

            <div id="inventory-card" class="card-base bg-white p-5 rounded-3xl shadow-lg mb-6 hidden">
                <h2 class="text-2xl font-semibold text-gray-600 mb-4 text-center pb-2 border-b border-dashed border-pink-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 18h-2a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-2" /><path d="M12 11v-6" /><path d="M8 7l4 -4l4 4" /><path d="M10 14h4" /></svg>
                    กระเป๋าของฉัน
                </h2>
                <div id="inventory-list" class="space-y-2"></div>
            </div>

            <div class="card-base bg-white p-5 rounded-3xl shadow-lg mb-6">
                <h2 class="text-2xl font-semibold text-gray-600 mb-4 text-center pb-2 border-b border-dashed border-pink-200 flex items-center justify-center">
                   <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11.5 21h-5.5a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v6" /><path d="M16 3v4" /><path d="M8 3v4" /><path d="M4 11h16" /><path d="M19 16l-2 3h4l-2 3" /></svg>
                    เช็คอินรายวัน
                </h2>
                <button id="check-in-btn" class="btn-base w-full px-4 py-3 text-lg font-bold text-white rounded-2xl shadow-md flex items-center justify-center border-b-4 bg-gradient-to-br from-sky-400 to-blue-500 border-sky-600 disabled:bg-gray-300 disabled:border-gray-400 disabled:cursor-not-allowed disabled:transform-none disabled:filter-grayscale">
                    เช็คอิน (รับ 5 เหรียญ)
                </button>
            </div>
            
            <div class="card-base bg-white p-5 rounded-3xl shadow-lg mb-6">
                <h2 class="text-2xl font-semibold text-gray-600 mb-4 text-center pb-2 border-b border-dashed border-pink-200 flex items-center justify-center">
                   <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2" /><path d="M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z" /><path d="M18 22l3.35 -3.284a2.143 2.143 0 0 0 .005 -3.071a2.242 2.242 0 0 0 -3.129 -.006l-.224 .22l-.223 -.22a2.242 2.242 0 0 0 -3.128 -.006a2.143 2.143 0 0 0 -.006 3.071l3.355 3.296z" /></svg>
                   ภารกิจรายวัน
                </h2>
                <div id="daily-missions-list" class="space-y-3"></div>
            </div>

            <div class="game-buttons-section mb-6">
                <h2 class="text-2xl font-semibold text-gray-600 mb-4 text-center pb-2 border-b border-dashed border-pink-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M2 12c0 -2.76 2.24 -5 5 -5h10c2.76 0 5 2.24 5 5v7h-20v-7z" /><path d="M5.5 12h.01" /><path d="M8.5 12h.01" /><path d="M15.5 12h.01" /><path d="M18.5 12h.01" /><path d="M15 5v-1a2 2 0 0 0 -2 -2h-2a2 2 0 0 0 -2 2v1" /></svg>
                    เล่นเกมกัน!
                </h2>
                <div id="game-card-container" class="grid gap-4" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));">
                    <a href="rps_game.html" class="game-card block p-4 rounded-2xl shadow-md text-center transition-all duration-300 border-b-4 relative overflow-hidden bg-gradient-to-br from-pink-400 to-red-400 border-pink-600 hover:transform hover:-translate-y-1" data-game-id="rps">
                        <h3 class="text-white text-xl font-bold mb-1 relative z-10 [text-shadow:1px_1px_2px_rgba(0,0,0,0.3)]">เป่ายิ้งฉุบ</h3>
                        <p class="text-white text-sm opacity-90 relative z-10">ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="memory_game.html" class="game-card block p-4 rounded-2xl shadow-md text-center transition-all duration-300 border-b-4 relative overflow-hidden bg-gradient-to-br from-sky-400 to-indigo-500 border-sky-600 hover:transform hover:-translate-y-1" data-game-id="memory">
                        <h3 class="text-white text-xl font-bold mb-1 relative z-10 [text-shadow:1px_1px_2px_rgba(0,0,0,0.3)]">จับคู่ภาพ</h3>
                        <p class="text-white text-sm opacity-90 relative z-10">ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="simon_game.html" class="game-card block p-4 rounded-2xl shadow-md text-center transition-all duration-300 border-b-4 relative overflow-hidden bg-gradient-to-br from-purple-400 to-fuchsia-500 border-purple-600 hover:transform hover:-translate-y-1" data-game-id="simon">
                        <h3 class="text-white text-xl font-bold mb-1 relative z-10 [text-shadow:1px_1px_2px_rgba(0,0,0,0.3)]">เกมกดตามม่อน</h3>
                        <p class="text-white text-sm opacity-90 relative z-10">ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="whac_a_mole_game.html" class="game-card block p-4 rounded-2xl shadow-md text-center transition-all duration-300 border-b-4 relative overflow-hidden bg-gradient-to-br from-indigo-500 to-purple-800 border-indigo-800 hover:transform hover:-translate-y-1" data-game-id="whac_a_mole">
                        <h3 class="text-white text-xl font-bold mb-1 relative z-10 [text-shadow:1px_1px_2px_rgba(0,0,0,0.3)]">เกมตีหัวม่อน</h3>
                        <p class="text-white text-sm opacity-90 relative z-10">ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="catch_falling_object.html" class="game-card block p-4 rounded-2xl shadow-md text-center transition-all duration-300 border-b-4 relative overflow-hidden bg-gradient-to-br from-rose-400 to-pink-500 border-rose-600 hover:transform hover:-translate-y-1" data-game-id="catch_object">
                        <h3 class="text-white text-xl font-bold mb-1 relative z-10 [text-shadow:1px_1px_2px_rgba(0,0,0,0.3)]">รับม่อนด้วย!</h3>
                        <p class="text-white text-sm opacity-90 relative z-10">ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="cafe.html" class="game-card block p-4 rounded-2xl shadow-md text-center transition-all duration-300 border-b-4 relative overflow-hidden bg-gradient-to-br from-amber-400 to-yellow-600 border-amber-600 hover:transform hover:-translate-y-1" data-game-id="cafe">
                        <h3 class="text-white text-xl font-bold mb-1 relative z-10 [text-shadow:1px_1px_2px_rgba(0,0,0,0.3)]">เกมคาเฟ่</h3>
                        <p class="text-white text-sm opacity-90 relative z-10">ใช้ 1 เหรียญ</p>
                    </a>
                </div>
            </div>

            <div class="game-buttons-section"> 
                <h2 class="text-2xl font-semibold text-gray-600 mb-4 text-center pb-2 border-b border-dashed border-pink-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mr-3" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.331 8h11.339a2 2 0 0 1 1.977 2.304l-1.255 8.152a3 3 0 0 1 -2.966 2.544h-6.852a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304z" /><path d="M9 11v-5a3 3 0 0 1 6 0v5" /></svg>
                    ร้านค้าของม่อน
                </h2>
                <button id="go-to-shop-btn" class="btn-base w-full px-4 py-3 text-lg font-bold text-white rounded-2xl shadow-md flex items-center justify-center border-b-4 bg-gradient-to-br from-amber-400 to-orange-500 border-amber-600">
                    ไปร้านค้าแลกของ
                </button>
            </div>
        </div>

        <div id="shop-screen" class="hidden">
            <header class="flex items-center mb-6">
                <button id="shop-back-btn" class="text-3xl text-pink-500 hover:text-pink-600 transition">&larr;</button>
                <h1 class="text-3xl sm:text-4xl font-bold text-pink-500 ml-4">ร้านค้าของม่อน</h1>
            </header>
            <div id="shop-items-list" class="space-y-4"></div>
        </div>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let state = {};

            const allMissions = [
                { text: 'ถ่ายรูปหน้าส่งให้ม่อน (1 เหรียญ)', reward: 1 }, 
                { text: 'ถ่าย ootd ส่งให้ม่อน (1 เหรียญ)', reward: 1 },
                { text: 'บอกรักม่อน (1 เหรียญ)', reward: 1 }, 
                { text: 'บอกคิดถึงม่อน (1 เหรียญ)', reward: 1 },
                { text: 'อัดคลิปบอกรักม่อน (1 เหรียญ)', reward: 1 }, 
                { text: 'ถ่ายรูปส่งจุ้บให้ม่อน (1 เหรียญ)', reward: 1 },
                { text: 'ร้องเพลงให้ม่อนฟัง (1 เหรียญ)', reward: 1 }, 
                { text: 'ถ่ายรูปอาหารส่งให้ม่อน (1 เหรียญ)', reward: 1 },
                { text: 'ทำให้ม่อนบอกรัก (1 เหรียญ)', reward: 1 }, 
                { text: 'ทำให้ม่อนบอกคิดถึง (1 เหรียญ)', reward: 1 },
				{ text: 'โชว์กินข้าวให้ม่อนดู (1 เหรียญ)', reward: 1 }, 
                { text: 'ทำหน้าแบ๊ว (1 เหรียญ)', reward: 1 },
                { text: 'ทำให้ม่อนยิ้ม (1 เหรียญ)', reward: 1 }, 
                { text: 'ถ่ายรูปตอนทาครีม (1 เหรียญ)', reward: 1 },
				{ text: 'บอกรักโดยไม่มีคำว่ารัก (1 เหรียญ)', reward: 1 }, 
                { text: 'ลงสตอรี่เกี่ยวกับม่อน (2 เหรียญ)', reward: 2 },
            ];
            
            const shopItems = [
                { id: 'ticket_random', name: 'ตั๋วสุ่มวงล้อ', price: 200 },  
                { id: 'ticket_trip', name: 'ตั๋วให้พาไปไหนก็ได้', price: 600 }, 
                { id: 'ticket_wish', name: 'ตั๋วที่ขออะไรก็ได้', price: 2000 }, 
                { id: 'ticket_command', name: 'ตั๋วที่ให้เค้าทำอะไรก็ได้', price: 1000 }, 
            ];
            
            const consumableItems = {
                'ticket_random': { name: 'ตั๋วสุ่มวงล้อ' },
                'ticket_trip': { name: 'ตั๋วให้พาไปไหนก็ได้' },
                'ticket_wish': { name: 'ตั๋วที่ขออะไรก็ได้' },
                'ticket_command': { name: 'ตั๋วที่ให้เค้าทำอะไรก็ได้' },
            };

            const allPlayableGames = [
                { id: 'rps', name: 'เป่ายิ้งฉุบ', file: 'rps_game.html' },
                { id: 'memory', name: 'จับคู่ภาพ', file: 'memory_game.html' },
                { id: 'simon', name: 'เกมกดตามม่อน', file: 'simon_game.html' },
                { id: 'whac_a_mole', name: 'เกมตีหัวม่อน', file: 'whac_a_mole_game.html' },
                { id: 'catch_object', name: 'รับม่อนด้วย!', file: 'catch_falling_object.html' },
                { id: 'cafe', name: 'เกมคาเฟ่', file: 'cafe.html' },
            ];

            const screens = {
                menu: document.getElementById('menu-screen'),
                shop: document.getElementById('shop-screen'),
            };
            const coinDisplays = {
                mon: document.getElementById('mon-coin-display'),
                play: document.getElementById('play-coin-display'),
            };
            const checkInBtn = document.getElementById('check-in-btn');
            const dailyMissionsList = document.getElementById('daily-missions-list');
            const shopItemsList = document.getElementById('shop-items-list');
            const inventoryCard = document.getElementById('inventory-card');
            const inventoryList = document.getElementById('inventory-list');
            const bonusGameSection = document.getElementById('bonus-game-section'); 
            const dailyBonusGameName = document.getElementById('daily-bonus-game-name'); 
            const gameCardContainer = document.getElementById('game-card-container');

            document.getElementById('go-to-shop-btn').addEventListener('click', () => showScreen('shop'));
            document.getElementById('shop-back-btn').addEventListener('click', () => showScreen('menu'));

            function saveState() {
                localStorage.setItem('monGameDataV14', JSON.stringify(state));
            }

            function loadState() {
                const savedData = localStorage.getItem('monGameDataV14');
                if (savedData) {
                    state = JSON.parse(savedData);
                } else {
                    state = {
                        monCoins: 1000, 
                        playCoins: 0, 
                        lastCheckinDate: null, 
                        dailyMissions: [],
                        lastMissionDate: null, 
                        inventory: {},
                        dailyBonusGameId: null,
                        lastBonusGameDate: null
                    };
                    generateNewMissions();
                }
            }

            function pickDailyBonusGame() {
                const today = new Date().toDateString();
                if (state.lastBonusGameDate !== today) {
                    const randomIndex = Math.floor(Math.random() * allPlayableGames.length);
                    state.dailyBonusGameId = allPlayableGames[randomIndex].id;
                    state.lastBonusGameDate = today;
                    saveState();
                }
                displayBonusGame();
            }

            function displayBonusGame() {
                if (!state.dailyBonusGameId) return;

                const bonusGame = allPlayableGames.find(game => game.id === state.dailyBonusGameId);
                if (bonusGame) {
                    dailyBonusGameName.textContent = bonusGame.name;
                    bonusGameSection.classList.remove('hidden');

                    gameCardContainer.querySelectorAll('.game-card').forEach(card => {
                        card.classList.remove('bonus-game');
                        // Construct the original href without query params
                        const gameData = allPlayableGames.find(g => g.id === card.dataset.gameId);
                        if (gameData) {
                            card.href = gameData.file; 
                            if (card.dataset.gameId === state.dailyBonusGameId) {
                                card.classList.add('bonus-game');
                                // The actual URL with bonus is handled by the click event listener
                            }
                        }
                    });
                }
            }

            function updateCoinDisplays() {
                coinDisplays.mon.textContent = state.monCoins;
                coinDisplays.play.textContent = state.playCoins;
            }

            function showScreen(screenName) {
                Object.values(screens).forEach(s => s.classList.add('hidden'));
                screens[screenName].classList.remove('hidden');
                if (screenName === 'menu') {
                    renderInventory(); 
                    displayBonusGame();
                }
            }
            
            function renderInventory() {
                inventoryList.innerHTML = '';
                const userItems = Object.keys(state.inventory).filter(key => state.inventory[key] > 0);

                if (userItems.length > 0) {
                    userItems.forEach(itemId => {
                        const itemDetails = consumableItems[itemId]; 
                        if (itemDetails) {
                            const itemEl = document.createElement('div');
                            itemEl.className = 'flex justify-between items-center bg-rose-50 p-3 rounded-lg border-l-4 border-rose-200 text-lg text-pink-700';
                            itemEl.innerHTML = `
                                <span class="font-semibold">${itemDetails.name}</span>
                                <div class="flex items-center gap-2">
                                    <span class="text-base font-bold bg-pink-200 text-pink-600 rounded-full px-3 py-1 ml-2">x${state.inventory[itemId]}</span>
                                    <button data-id="${itemId}" class="play-item-btn btn-base px-3 py-1 text-sm font-bold text-white rounded-lg shadow-md border-b-2" style="background-color: #8A2BE2; border-bottom-color: #6A1BAE;">ใช้</button>
                                </div>
                            `;
                            inventoryList.appendChild(itemEl);
                        }
                    });
                    inventoryCard.classList.remove('hidden');
                    document.querySelectorAll('.play-item-btn').forEach(button => {
                        button.addEventListener('click', useItem);
                    });
                } else {
                    inventoryCard.classList.add('hidden');
                }
            }

            function useItem(event) {
                const itemId = event.target.dataset.id;
                if (state.inventory[itemId] > 0) {
                    const itemDetails = consumableItems[itemId];
                    alert(`ใช้ไอเทม: ${itemDetails.name}!`);
                    
                    state.inventory[itemId]--; 
                    
                    saveState();
                    renderInventory(); 
                    updateCoinDisplays(); 
                }
            }
            
            function updateCheckInButton() {
                const today = new Date().toDateString();
                if (state.lastCheckinDate === today) {
                    checkInBtn.textContent = 'เช็คอินแล้ววันนี้!';
                    checkInBtn.disabled = true;
                } else {
                    checkInBtn.textContent = 'เช็คอิน (รับ 5 เหรียญ)';
                    checkInBtn.disabled = false;
                }
            }
            
            checkInBtn.addEventListener('click', () => {
                const today = new Date().toDateString();
                if (state.lastCheckinDate !== today) {
                    state.playCoins += 5;
                    state.lastCheckinDate = today;
                    updateCoinDisplays();
                    updateCheckInButton();
                    saveState();
                    alert('เช็คอินสำเร็จ! คุณได้รับ 5 เหรียญเล่นม่อน');
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                }
            });

            function generateNewMissions() {
                const shuffled = [...allMissions].sort(() => 0.5 - Math.random());
                state.dailyMissions = shuffled.slice(0, 5).map(mission => ({ ...mission, completed: false }));
            }

            function renderMissions() {
                dailyMissionsList.innerHTML = '';
                state.dailyMissions.forEach((mission, index) => {
                    const missionEl = document.createElement('div');
                    const isCompleted = mission.completed;
                    
                    missionEl.className = `flex justify-between items-center bg-pink-50 p-3 rounded-lg border-l-4 border-pink-200 text-base text-gray-600 transition-opacity duration-300 ${isCompleted ? 'opacity-60' : ''}`;
                    
                    const btnClass = isCompleted 
                        ? 'bg-gradient-to-br from-green-400 to-emerald-500 border-green-600'
                        : 'bg-gradient-to-br from-pink-400 to-rose-400 border-pink-600';
                    
                    const btnContent = isCompleted 
                        ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l5 5l10 -10" /></svg>` 
                        : 'เสร็จสิ้น';

                    missionEl.innerHTML = `
                        <p class="font-medium transition-all duration-300 ${isCompleted ? 'line-through' : ''}">${mission.text}</p>
                        <button data-index="${index}" class="btn-base text-sm px-3 py-2 rounded-xl font-semibold text-white shadow-md flex items-center justify-center border-b-4 ml-2 ${btnClass}">${btnContent}</button>`;
                    
                    dailyMissionsList.appendChild(missionEl);
                });

                document.querySelectorAll('button[data-index]').forEach(btn => {
                    const index = btn.dataset.index;
                    const mission = state.dailyMissions[index];
                    if (!mission.completed) {
                        btn.addEventListener('click', () => {
                            mission.completed = true;
                            state.playCoins += mission.reward;
                            updateCoinDisplays();
                            renderMissions();
                            saveState();
                            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                        });
                    }
                });
            }

            function renderShopItems() {
                shopItemsList.innerHTML = '';
                shopItems.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'card-base flex justify-between items-center bg-white p-4 rounded-2xl border-l-8 border-amber-300';
                    itemEl.innerHTML = `
                        <div>
                            <p class="text-lg font-semibold text-gray-700">${item.name}</p>
                            <p class="text-base font-bold text-amber-500 flex items-center">
                                ${item.price} <img src="mon_coin_icon.png" class="w-5 h-5 ml-1">
                            </p>
                        </div>
                        <button data-price="${item.price}" data-id="${item.id}" class="buy-item-btn btn-base px-5 py-2 text-base font-bold text-white rounded-xl shadow-lg flex items-center justify-center border-b-4 bg-gradient-to-br from-pink-500 to-rose-500 border-rose-700 ml-3">
                            ซื้อ
                        </button>`;
                    shopItemsList.appendChild(itemEl);
                });

                document.querySelectorAll('.buy-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const price = parseInt(e.currentTarget.dataset.price);
                        const itemId = e.currentTarget.dataset.id;
                        if (state.monCoins >= price) {
                            state.monCoins -= price;
                            state.inventory[itemId] = (state.inventory[itemId] || 0) + 1;
                            updateCoinDisplays();
                            renderInventory(); 
                            saveState();
                            alert('ซื้อสำเร็จ! ไอเทมถูกเพิ่มในกระเป๋าแล้วค่ะ');
                            confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 }, scalar: 1.2 });
                        } else {
                            alert('อุ๊ย! เหรียญม่อนไม่พอจ้า!');
                        }
                    });
                });
            }

            function init() {
                loadState();
                const today = new Date().toDateString();
                if(state.lastMissionDate !== today) {
                    generateNewMissions();
                    state.lastMissionDate = today;
                    saveState();    
                }
                updateCoinDisplays();
                updateCheckInButton();
                renderMissions();
                renderShopItems();
                renderInventory(); 
                pickDailyBonusGame();
                showScreen('menu'); 

                // ++ เพิ่มโค้ดจัดการการคลิกเกมการ์ด ++
                document.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('click', (event) => {
                        event.preventDefault(); // หยุดการเปลี่ยนหน้าทันที

                        const gameId = card.dataset.gameId;
                        let targetUrl = card.href;

                        if (state.playCoins > 0) {
                            state.playCoins--;
                            updateCoinDisplays();
                            saveState();

                            // ถ้าเป็นเกมโบนัส ให้เพิ่ม parameter เข้าไปใน URL
                            if (gameId === state.dailyBonusGameId) {
                                targetUrl += '?bonus=true';
                            }
                            
                            window.location.href = targetUrl; // ไปยังหน้าเกม
                        } else {
                            alert('เหรียญเล่นม่อนไม่พอจ้า! เช็คอินหรือทำภารกิจรายวันก่อนนะ');
                        }
                    });
                });
            }

            init();
        });
    </script>
</body>
</html>