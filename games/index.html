<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เกมของม่อน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #fdf2f8; /* bg-pink-50 */
            background-image: radial-gradient(#fecdd3 1px, transparent 1px);
            background-size: 15px 15px;
            color: #4a5568; /* text-gray-700 */
        }
        .hidden {
            display: none;
        }
        .app-container {
            background-color: #fff0f5; /* Lavender Blush */
            box-shadow: 0 0 40px rgba(219, 39, 119, 0.15);
        }
        .card {
            /* Basic card styling */
            @apply bg-white p-5 rounded-3xl shadow-lg transition-all duration-300;
            border: 2px solid #FBCFE8; /* Soft pink border */
            background: linear-gradient(145deg, #fffafa, #ffe4e6); /* Light pink gradient */
            box-shadow: 0 5px 15px rgba(219, 39, 119, 0.1), inset 0 0 5px rgba(255,255,255,0.5);
        }

        /* General button styling */
        .btn {
            @apply w-full px-4 py-3 text-lg font-bold text-white rounded-2xl shadow-md transition-all duration-300 flex items-center justify-center border-b-4;
            transform: translateY(0);
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }
        .btn:active {
            transform: translateY(2px);
            @apply shadow-sm;
        }

        /* Specific button colors */
        .btn-play { @apply bg-gradient-to-br from-pink-400 to-red-400 border-pink-600; }
        .btn-play-memory { @apply bg-gradient-to-br from-sky-400 to-indigo-500 border-sky-600; }
        .btn-play-simon { @apply bg-gradient-to-br from-purple-400 to-fuchsia-500 border-purple-600; }
        .btn-shop { @apply bg-gradient-to-br from-amber-400 to-orange-500 border-amber-600; }
        .btn-checkin { @apply bg-gradient-to-br from-sky-400 to-blue-500 border-sky-600; }
        .btn-disabled {
            @apply bg-gray-300 border-gray-400 cursor-not-allowed;
            transform: translateY(0) !important;
            filter: grayscale(1);
        }

        /* Mission button styling */
        .mission-btn {
            @apply text-sm px-4 py-2 rounded-xl font-semibold text-white shadow-md transition-all duration-200 flex items-center justify-center border-b-4;
            transform: translateY(0);
        }
        .mission-btn.incomplete { @apply bg-gradient-to-br from-green-400 to-emerald-500 border-green-700; }
        .mission-btn.incomplete:hover { transform: translateY(-2px); @apply shadow-lg; filter: brightness(1.05); }
        .mission-btn.incomplete:active { transform: translateY(1px); @apply shadow-sm border-b-2; }
        .mission-btn.completed { @apply bg-gradient-to-br from-gray-400 to-gray-500 border-gray-600 cursor-default; }

        /* Buy item button styling */
        .buy-item-btn {
            @apply px-5 py-2 text-base font-bold text-white rounded-xl shadow-lg transition-all duration-200 flex items-center justify-center border-b-4;
            @apply bg-gradient-to-br from-pink-500 to-rose-500 border-rose-700;
            transform: translateY(0);
        }
        .buy-item-btn:hover { transform: translateY(-2px); @apply shadow-xl; filter: brightness(1.1); }
        .buy-item-btn:active { transform: translateY(1px); @apply shadow-md border-b-2; }

        /* Inventory item "ใช้" button */
        .play-item-btn {
            @apply px-3 py-1 text-sm font-bold text-white rounded-lg shadow-md transition-all duration-200 border-b-2;
            background-color: #8A2BE2; /* Blue-violet */
            border-bottom-color: #6A1BAE;
        }
        .play-item-btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
        .play-item-btn:active { transform: translateY(0.5px); box-shadow: inset 0 0 3px rgba(0,0,0,0.2); border-bottom-width: 1px; }
        .play-item-btn:disabled { @apply bg-gray-300 border-gray-400 cursor-not-allowed; transform: translateY(0) !important; }

        /* --- Custom UI Styling for Clarity and Aesthetics --- */

        /* Header Title */
        .main-header-title {
            font-size: 2.75rem; /* text-4xl base */
            line-height: 1.1;
            font-weight: 700; /* font-bold */
            color: #DB2777; /* pink-600 */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2); /* Soft shadow for depth */
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: 1.125rem; /* text-lg */
            color: #EC4899; /* pink-500 */
            font-weight: 500; /* font-medium */
        }

        /* Card Headers */
        .card-header {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #6B7280; /* gray-600 */
            margin-bottom: 1rem;
            text-align: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px dashed #FBCFE8; /* Light dashed line */
        }

        /* Wallet Display */
        .wallet-section {
            @apply flex justify-around items-center;
            padding-top: 0.5rem;
        }
        .wallet-coin-display {
            font-size: 2.5rem; /* text-4xl */
            font-weight: 700; /* font-bold */
        }
        .wallet-coin-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #9CA3AF; /* gray-400 */
        }
        .mon-coin-color { color: #F59E0B; /* amber-500 */ }
        .play-coin-color { color: #10B981; /* emerald-500 */ }

        /* Inventory Item */
        .inventory-item {
            @apply flex justify-between items-center bg-rose-50 p-3 rounded-lg border-l-4 border-rose-200;
            font-size: 1.125rem; /* text-lg */
            color: #BE185D; /* pink-700 */
        }
        .inventory-item span:first-child { font-weight: 600; } /* Item name */
        .inventory-item span:last-child {
            font-size: 1rem; /* text-base */
            font-weight: 700;
            background-color: #FBCFE8; /* pink-200 */
            color: #DB2777; /* pink-600 */
            border-radius: 9999px; /* rounded-full */
            padding: 0.25rem 0.75rem; /* px-3 py-1 */
            margin-left: 0.5rem;
        }
        .inventory-item .play-item-btn { margin-left: 0.75rem; }

        /* Mission Item */
        .mission-item {
            @apply flex justify-between items-center bg-pink-50 p-3 rounded-lg border-l-4 border-pink-200;
            font-size: 1rem; /* text-base */
            color: #6B7280; /* gray-600 */
        }
        .mission-item p { font-weight: 500; }
        .mission-item .mission-btn { margin-left: 0.5rem; }

        /* Shop Item */
        .shop-item {
            @apply flex justify-between items-center bg-pink-50 p-3 rounded-lg border-l-4 border-pink-200;
        }
        .shop-item-name {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600;
            color: #BE185D; /* pink-700 */
        }
        .shop-item-price {
            font-size: 1rem; /* text-base */
            font-weight: 700;
            color: #F59E0B; /* amber-500 */
            margin-left: 0.5rem;
        }
        .shop-item .buy-item-btn { margin-left: 0.75rem; }


        /* --- Game Card Styling --- */
        .game-card-grid {
            @apply grid gap-4;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        .game-card {
            @apply block p-4 rounded-2xl shadow-md text-center transition-all duration-300;
            border-bottom: 4px solid;
            position: relative;
            overflow: hidden; 
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1), inset 0 0 5px rgba(255,255,255,0.7);
        }
        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2), inset 0 0 8px rgba(255,255,255,0.9);
        }
        .game-card h3 {
            font-family: 'Kanit', sans-serif; /* Ensure Kanit font */
            @apply text-white text-xl font-bold mb-1 relative z-10; 
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        .game-card p {
            font-family: 'Kanit', sans-serif; /* Ensure Kanit font */
            @apply text-white text-sm opacity-90 relative z-10;
        }

        /* Specific game card colors */
        .game-card.rps {
            background: linear-gradient(to bottom right, #EC4899, #F43F5E); /* Pink-red */
            border-bottom-color: #BE185D;
        }
        
        .game-card.memory {
            background: linear-gradient(to bottom right, #3B82F6, #2563EB); /* Blue */
            border-bottom-color: #1D4ED8;
        }

        .game-card.simon {
            background: linear-gradient(to bottom right, #A855F7, #9333EA); /* Purple */
            border-bottom-color: #7E22CE;
        }
        
        .game-card.whac-a-mole {
            background: linear-gradient(to bottom right, #6D28D9, #4C1D95); /* Deep purple */
            border-bottom-color: #3B0764;
        }

        .game-card.catch-object {
            background: linear-gradient(to bottom right, #F472B6, #EC4899); /* Rose pink */
            border-bottom-color: #DB2777;
        }

        /* NEW: Bonus Game Highlight */
        .game-card.bonus-game {
            border: 4px solid #FFD700; /* Gold border */
            box-shadow: 0 0 15px rgba(255,215,0,0.8), 0 0 30px rgba(255,215,0,0.6), 0 0 50px rgba(255,215,0,0.4); /* Stronger multi-layer glow */
            transform: scale(1.05); /* Slightly larger */
            transition: all 0.3s ease-in-out; /* Smooth transition for scale and shadow */
            background: linear-gradient(145deg, #FFD700, #FFA500); /* Gold to Orange gradient */
            border-bottom-color: #FF8C00; /* Darker orange border */
        }
        /* Specific text styles for bonus game card */
        .game-card.bonus-game h3, .game-card.bonus-game p {
            font-family: 'Kanit', sans-serif; /* Ensure Kanit font */
            color: #FFFFFF; /* White text on gold background */
            text-shadow: 0 0 5px rgba(0,0,0,0.7), 0 0 10px rgba(255,255,255,0.5); /* Stronger shadow/glow for text */
        }
        .game-card.bonus-game:hover {
            transform: translateY(-5px) scale(1.07); /* More pronounced hover */
            box-shadow: 0 0 25px rgba(255,215,0,0.9), 0 0 50px rgba(255,215,0,0.7), 0 0 80px rgba(255,215,0,0.5); /* Even stronger glow on hover */
        }
        .bonus-game-header {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: #FFD700; /* Gold */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
            margin-bottom: 0.75rem;
        }

    </style>
</head>
<body>

    <div id="app-container" class="app-container max-w-md mx-auto min-h-screen p-4">

        <div id="menu-screen">
            <header class="text-center mb-6">
                <h1 class="main-header-title">
                    เกมของม่อน
                </h1>
                <p class="subtitle mt-1">มาเล่นกันเถอะ!</p>
            </header>

            <div id="bonus-game-section" class="card mb-6 hidden">
                <h2 class="card-header bonus-game-header">
                    🎉 เกมโบนัสวันนี้ (x2 เหรียญม่อน)! 🎉
                </h2>
                <div class="text-center text-gray-700 font-semibold text-xl">
                    <span id="daily-bonus-game-name"></span>
                </div>
            </div>

            <div class="card mb-6">
                <h2 class="card-header">
                    💰 กระเป๋าเงิน
                </h2>
                <div class="wallet-section">
                    <div class="text-center">
                        <p class="wallet-coin-display mon-coin-color" id="mon-coin-display">0</p>
                        <p class="wallet-coin-label">เหรียญม่อน ($)</p>
                    </div>
                    <div class="text-center">
                        <p class="wallet-coin-display play-coin-color" id="play-coin-display">0</p>
                        <p class="wallet-coin-label">เหรียญเล่นม่อน</p>
                    </div>
                </div>
            </div>

            <div id="inventory-card" class="card mb-6 hidden">
                   <h2 class="card-header">
                     🎒 กระเป๋าของฉัน
                </h2>
                <div id="inventory-list" class="space-y-2"></div>
            </div>

            <div class="card mb-6">
                <h2 class="card-header">
                    🗓️ เช็คอินรายวัน
                </h2>
                <button id="check-in-btn" class="btn btn-checkin">
                    เช็คอิน (รับ 5 เหรียญ)
                </button>
            </div>
            
            <div class="card mb-6">
                   <h2 class="card-header">
                     🎯 ภารกิจรายวัน
                </h2>
                <div id="daily-missions-list" class="space-y-3"></div>
            </div>

            <div class="game-buttons-section">
                <h2 class="card-header">
                    🎮 เล่นเกมกัน!
                </h2>
                <div class="game-card-grid" id="game-card-list">
                    <a href="rps_game.html" class="game-card rps" data-game-id="rps">
                        <h3>เป่ายิ้งฉุบ</h3>
                        <p>ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="memory_game.html" class="game-card memory" data-game-id="memory">
                        <h3>จับคู่ภาพ</h3>
                        <p>ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="simon_game.html" class="game-card simon" data-game-id="simon">
                        <h3>เกมกดตามม่อน</h3>
                        <p>ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="whac_a_mole_game.html" class="game-card whac-a-mole" data-game-id="whac_a_mole">
                        <h3>เกมตีหัวม่อน</h3>
                        <p>ใช้ 1 เหรียญ</p>
                    </a>
                    <a href="catch_falling_object.html" class="game-card catch-object" data-game-id="catch_object">
                        <h3>รับม่อนด้วย!</h3>
                        <p>ใช้ 1 เหรียญ</p>
                    </a>
                </div>
            </div>

            <div class="game-buttons-section"> 
                <h2 class="card-header">
                    🛍️ ร้านค้าของม่อน
                </h2>
                <button id="go-to-shop-btn" class="btn btn-shop">
                    ไปร้านค้าแลกของ
                </button>
            </div>


        </div>

        <div id="shop-screen" class="hidden">
            <header class="flex items-center mb-6">
                <button id="shop-back-btn" class="text-3xl text-pink-500 hover:text-pink-600 transition">&larr;</button>
                <h1 class="text-3xl sm:text-4xl font-bold text-pink-500 ml-4">ร้านค้าของม่อน</h1>
            </header>
            <div id="shop-items-list" class="space-y-4"></div>
        </div>
        
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let state = {};

            const allMissions = [
                { text: 'ถ่ายรูปหน้าส่งให้ม่อน', reward: 1 }, { text: 'ถ่ายootdส่งให้ม่อน', reward: 1 },
                { text: 'บอกรักม่อน', reward: 1 }, { text: 'บอกคิดถึงม่อน', reward: 1 },
                { text: 'อัดคลิปบอกรักม่อน', reward: 1 }, { text: 'ถ่ายรูปส่งจุ้บให้ม่อน', reward: 1 },
                { text: 'ร้องเพลงให้ม่อนฟัง', reward: 1 }, { text: 'ถ่ายรูปอาหารส่งให้ม่อน', reward: 1 },
                { text: 'ทำให้ม่อนบอกรัก', reward: 1 }, { text: 'ทำให้ม่อนบอกคิดถึง', reward: 1 },
            ];
            
            const shopItems = [
                // ราคาสินค้าเพิ่มขึ้น 2 เท่า
                { id: 'ticket_random', name: 'ตั๋วสุ่มวงล้อ', price: 200 },  
                { id: 'ticket_trip', name: 'ตั๋วให้พาไปไหนก็ได้', price: 600 }, 
                { id: 'ticket_wish', name: 'ตั๋วที่ขออะไรก็ได้', price: 2000 }, 
                { id: 'ticket_command', name: 'ตั๋วที่ให้เค้าทำอะไรก็ได้', price: 1000 }, 
            ];
            
            // ข้อมูลไอเทมที่ใช้ได้ (เพื่อแสดงในกระเป๋า)
            const consumableItems = {
                'ticket_random': { name: 'ตั๋วสุ่มวงล้อ', action: () => alert('ใช้: ตั๋วสุ่มวงล้อ - วงล้อหมุนติ้วๆ!') },
                'ticket_trip': { name: 'ตั๋วให้พาไปไหนก็ได้', action: () => alert('ใช้: ตั๋วให้พาไปไหนก็ได้ - รอเค้าพาไปนะ') },
                'ticket_wish': { name: 'ตั๋วที่ขออะไรก็ได้', action: () => alert('ใช้: ตั๋วที่ขออะไรก็ได้ - ขออะไรดีน้า') },
                'ticket_command': { name: 'ตั๋วที่ให้เค้าทำอะไรก็ได้', action: () => alert('ใช้: ตั๋วที่ให้เค้าทำอะไรก็ได้ - อืม.. ให้อะไรดี') },
            };

            // NEW: List of all playable games for bonus system
            const allPlayableGames = [
                { id: 'rps', name: 'เป่ายิ้งฉุบ', file: 'rps_game.html' },
                { id: 'memory', name: 'จับคู่ภาพ', file: 'memory_game.html' },
                { id: 'simon', name: 'เกมกดตามม่อน', file: 'simon_game.html' },
                { id: 'whac_a_mole', name: 'เกมตีหัวม่อน', file: 'whac_a_mole_game.html' },
                { id: 'catch_object', name: 'รับม่อนด้วย!', file: 'catch_falling_object.html' },
            ];


            // --- DOM ELEMENTS ---
            const screens = {
                menu: document.getElementById('menu-screen'),
                shop: document.getElementById('shop-screen'),
            };
            const coinDisplays = {
                mon: document.getElementById('mon-coin-display'),
                play: document.getElementById('play-coin-display'),
            };
            const checkInBtn = document.getElementById('check-in-btn');
            const dailyMissionsList = document.getElementById('daily-missions-list');
            const shopItemsList = document.getElementById('shop-items-list');
            const inventoryCard = document.getElementById('inventory-card');
            const inventoryList = document.getElementById('inventory-list');
            const bonusGameSection = document.getElementById('bonus-game-section'); 
            const dailyBonusGameName = document.getElementById('daily-bonus-game-name'); 
            const gameCardList = document.getElementById('game-card-list'); 


            // --- NAVIGATION BUTTONS ---
            document.getElementById('go-to-shop-btn').addEventListener('click', () => showScreen('shop'));
            document.getElementById('shop-back-btn').addEventListener('click', () => showScreen('menu'));

            // --- LOCAL STORAGE ---
            function saveState() {
                localStorage.setItem('monGameDataV14', JSON.stringify(state));
            }

            function loadState() {
                const savedData = localStorage.getItem('monGameDataV14');
                if (savedData) {
                    state = JSON.parse(savedData);
                } else {
                    state = {
                        monCoins: 1000, 
                        playCoins: 0, 
                        rpsStreak: 0,
                        lastCheckinDate: null, 
                        dailyMissions: [],
                        lastMissionDate: null, 
                        inventory: {},
                        // NEW: Bonus game state
                        dailyBonusGameId: null,
                        lastBonusGameDate: null
                    };
                    generateNewMissions();
                }
            }

            // NEW: Function to pick daily bonus game
            function pickDailyBonusGame() {
                const today = new Date().toDateString();
                if (state.lastBonusGameDate !== today) {
                    const randomIndex = Math.floor(Math.random() * allPlayableGames.length);
                    state.dailyBonusGameId = allPlayableGames[randomIndex].id;
                    state.lastBonusGameDate = today;
                    saveState();
                }
                displayBonusGame();
            }

            // NEW: Function to display bonus game
            function displayBonusGame() {
                if (state.dailyBonusGameId) {
                    const bonusGame = allPlayableGames.find(game => game.id === state.dailyBonusGameId);
                    if (bonusGame) {
                        dailyBonusGameName.textContent = bonusGame.name;
                        bonusGameSection.classList.remove('hidden');

                        // Highlight the bonus game card and set href with bonus parameter
                        gameCardList.querySelectorAll('.game-card').forEach(card => {
                            card.classList.remove('bonus-game'); // Remove from previous bonus game
                            const gameData = allPlayableGames.find(g => g.id === card.dataset.gameId);
                            if (gameData) {
                                card.href = gameData.file; // Reset to base file name
                                if (card.dataset.gameId === state.dailyBonusGameId) {
                                    card.classList.add('bonus-game');
                                    card.href = `${gameData.file}?bonus=true`; // Add bonus parameter to URL
                                }
                            }
                        });
                    }
                }
            }

            // This global function is now deprecated as we pass data via URL
            // window.isBonusGame = function(gameId) { /* ... (this part is no longer needed/used by game files directly) ... */ }


            // --- UI UPDATE & NAVIGATION ---
            function updateCoinDisplays() {
                coinDisplays.mon.textContent = state.monCoins;
                coinDisplays.play.textContent = state.playCoins;
            }

            function showScreen(screenName) {
                Object.values(screens).forEach(s => s.classList.add('hidden'));
                screens[screenName].classList.remove('hidden');
                if (screenName === 'menu') {
                    renderInventory(); 
                    displayBonusGame(); // Re-display bonus game when returning to menu
                }
            }
            
            function renderInventory() {
                inventoryList.innerHTML = '';
                const userItems = Object.keys(state.inventory).filter(key => state.inventory[key] > 0);

                if (userItems.length > 0) {
                    userItems.forEach(itemId => {
                        const itemDetails = consumableItems[itemId]; 
                        if (itemDetails) {
                            const itemEl = document.createElement('div');
                            itemEl.className = 'bg-rose-100 p-3 rounded-lg flex justify-between items-center inventory-item';
                            itemEl.innerHTML = `
                                <span class="font-medium text-rose-700">${itemDetails.name}</span>
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-rose-400 inventory-count">x${state.inventory[itemId]}</span>
                                    <button data-id="${itemId}" class="play-item-btn">ใช้</button>
                                </div>
                            `;
                            inventoryList.appendChild(itemEl);
                        }
                    });
                    inventoryCard.classList.remove('hidden');
                    document.querySelectorAll('.play-item-btn').forEach(button => {
                        button.addEventListener('click', useItem);
                    });
                } else {
                    inventoryCard.classList.add('hidden');
                }
            }

            function useItem(event) {
                const itemId = event.target.dataset.id;
                if (state.inventory[itemId] > 0) {
                    state.inventory[itemId]--; 
                    const itemDetails = consumableItems[itemId];
                    if (itemDetails && itemDetails.action) {
                        itemDetails.action(); 
                    } else {
                        alert(`ใช้ไอเทม: ${itemDetails.name} (แต่ไม่มีผลอะไรพิเศษตอนนี้)`);
                    }
                    
                    saveState();
                    renderInventory(); 
                    updateCoinDisplays(); 
                }
            }
            
            // --- CHECK-IN LOGIC ---
            function updateCheckInButton() {
                const today = new Date().toDateString();
                if (state.lastCheckinDate === today) {
                    checkInBtn.innerHTML = `เช็คอินแล้ววันนี้!`;
                    checkInBtn.disabled = true;
                    checkInBtn.classList.add('btn-disabled');
                } else {
                    checkInBtn.innerHTML = `เช็คอิน (รับ 5 เหรียญ)`;
                    checkInBtn.disabled = false;
                    checkInBtn.classList.remove('btn-disabled');
                }
            }
            
            checkInBtn.addEventListener('click', () => {
                const today = new Date().toDateString();
                if (state.lastCheckinDate !== today) {
                    state.playCoins += 5;
                    state.lastCheckinDate = today;
                    updateCoinDisplays();
                    updateCheckInButton();
                    saveState();
                    alert('เช็คอินสำเร็จ! คุณได้รับ 5 เหรียญเล่นม่อน');
                }
            });

            // --- DAILY MISSIONS LOGIC ---
            function generateNewMissions() {
                const shuffled = [...allMissions].sort(() => 0.5 - Math.random());
                state.dailyMissions = shuffled.slice(0, 5).map(mission => ({ ...mission, completed: false }));
            }

            function renderMissions() {
                dailyMissionsList.innerHTML = '';
                state.dailyMissions.forEach((mission, index) => {
                    const missionEl = document.createElement('div');
                    missionEl.className = 'flex justify-between items-center bg-pink-50 p-3 rounded-lg border-l-4 border-pink-200 mission-item';
                    const btnClass = mission.completed ? 'completed' : 'incomplete';
                    const btnContent = mission.completed 
                        ? `สำเร็จ`
                        : 'เสร็จสิ้น';

                    missionEl.innerHTML = `<p class="text-gray-600">${mission.text}</p><button data-index="${index}" class="mission-btn ${btnClass}">${btnContent}</button>`;
                    dailyMissionsList.appendChild(missionEl);
                });

                document.querySelectorAll('.mission-btn.incomplete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = e.currentTarget.dataset.index;
                        const mission = state.dailyMissions[index];
                        if (!mission.completed) {
                            mission.completed = true;
                            state.playCoins += mission.reward;
                            updateCoinDisplays();
                            renderMissions();
                            saveState();
                        }
                    });
                });
            }

            // --- SHOP LOGIC ---
            function renderShopItems() {
                shopItemsList.innerHTML = '';
                shopItems.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'card flex justify-between items-center shop-item';
                    itemEl.innerHTML = `
                        <div>
                            <p class="shop-item-name">${item.name}</p>
                            <p class="shop-item-price">${item.price} $</p>
                        </div>
                        <button data-price="${item.price}" data-id="${item.id}" class="buy-item-btn">
                            ซื้อ
                        </button>`;
                    shopItemsList.appendChild(itemEl);
                });

                document.querySelectorAll('.buy-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const price = parseInt(e.currentTarget.dataset.price);
                        const itemId = e.currentTarget.dataset.id;
                        if (state.monCoins >= price) {
                            state.monCoins -= price;
                            state.inventory[itemId] = (state.inventory[itemId] || 0) + 1;
                            updateCoinDisplays();
                            renderInventory(); 
                            saveState();
                            alert('ซื้อสำเร็จ! ตั๋วถูกเพิ่มในกระเป๋าแล้วค่ะ');
                        } else {
                            alert('อุ๊ย! เหรียญม่อนไม่พอจ้า!');
                        }
                    });
                });
            }

            // --- INITIALIZATION ---
            function init() {
                loadState();
                const today = new Date().toDateString();
                if(state.lastMissionDate !== today) {
                    generateNewMissions();
                    state.lastMissionDate = today;
                    saveState();    
                }
                updateCoinDisplays();
                updateCheckInButton();
                renderMissions();
                renderShopItems();
                renderInventory(); 
                pickDailyBonusGame(); // Pick and display bonus game on initial load
                showScreen('menu'); 
            }

            init();
        });
    </script>
</body>
</html>