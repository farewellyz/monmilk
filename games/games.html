<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏°‡πà‡∏≠‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #fdf2f8; /* bg-pink-50 */
            background-image: radial-gradient(#fecdd3 1px, transparent 1px);
            background-size: 15px 15px;
        }
        .hidden {
            display: none;
        }
        .app-container {
            background-color: #fff0f5; /* Lavender Blush */
            box-shadow: 0 0 40px rgba(219, 39, 119, 0.15);
        }
        .card {
            @apply bg-white p-5 rounded-3xl shadow-lg transition-all duration-300;
        }
        .btn {
            @apply w-full px-4 py-3 text-lg font-bold text-white rounded-2xl shadow-md transition-all duration-300 flex items-center justify-center gap-2 border-b-4;
            transform: translateY(0);
        }
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }
        .btn:active {
            transform: translateY(2px);
            @apply shadow-sm;
        }
        .btn-play {
            @apply bg-gradient-to-br from-pink-400 to-red-400 border-pink-600;
        }
        .btn-play-memory {
            @apply bg-gradient-to-br from-sky-400 to-indigo-500 border-sky-600;
        }
        .btn-shop {
            @apply bg-gradient-to-br from-amber-400 to-orange-500 border-amber-600;
        }
        .btn-checkin {
            @apply bg-gradient-to-br from-sky-400 to-blue-500 border-sky-600;
        }
        .btn-disabled {
            @apply bg-gray-300 border-gray-400 cursor-not-allowed;
            transform: translateY(0) !important;
            filter: grayscale(1);
        }
        .mission-btn {
            @apply text-sm px-4 py-2 rounded-xl font-semibold text-white shadow-md transition-all duration-200 flex items-center gap-1.5 border-b-4;
            transform: translateY(0);
        }
        .mission-btn.incomplete {
            @apply bg-gradient-to-br from-green-400 to-emerald-500 border-green-700;
        }
        .mission-btn.incomplete:hover {
            transform: translateY(-2px); @apply shadow-lg; filter: brightness(1.05);
        }
        .mission-btn.incomplete:active {
            transform: translateY(1px); @apply shadow-sm border-b-2;
        }
        .mission-btn.completed {
            @apply bg-gradient-to-br from-gray-400 to-gray-500 border-gray-600 cursor-default;
        }
        .buy-item-btn {
            @apply px-5 py-2 text-base font-bold text-white rounded-xl shadow-lg transition-all duration-200 flex items-center justify-center gap-2 border-b-4;
            @apply bg-gradient-to-br from-pink-500 to-rose-500 border-rose-700;
            transform: translateY(0);
        }
        .buy-item-btn:hover {
            transform: translateY(-2px); @apply shadow-xl; filter: brightness(1.1);
        }
        .buy-item-btn:active {
            transform: translateY(1px); @apply shadow-md border-b-2;
        }
        .game-choice-btn img {
            @apply rounded-2xl shadow-lg transition-all duration-300;
            border: 4px solid transparent;
        }
        .game-choice-btn:hover img {
            @apply scale-105 shadow-xl;
        }
        .game-choice-btn.selected img {
            @apply border-pink-400 scale-110;
        }

        /* === Memory Game Styles === */
        .memory-grid {
            /* Default for 4x4 (16 cards) */
            width: 408px;
            height: 408px;
            
            display: grid;
            grid-template-columns: repeat(4, 100px);
            grid-template-rows: repeat(4, 100px);
            gap: 0;
            margin: 0 auto;
        }

        /* New: CSS for 2x4 grid (8 cards) for easier levels */
        .memory-grid.small-grid {
            width: 204px; /* 2 * 100px (cards) + 2 * 2px (border) = 204px */
            height: 408px; /* 4 * 100px (cards) + 4 * 2px (border) = 408px */
            grid-template-columns: repeat(2, 100px); /* 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
            grid-template-rows: repeat(4, 100px);    /* 4 ‡πÅ‡∏ñ‡∏ß */
        }

        .memory-card {
            border: 2px solid black;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            aspect-ratio: 1 / 1;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        .memory-card .front, .memory-card .back {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 6px;
            backface-visibility: hidden;
        }
        .memory-card .front {
            background-color: #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #6b7280;
            font-weight: bold;
            box-shadow: inset 0 0 0 4px rgba(255,255,255,0.5), inset 0 0 0 6px rgba(0,0,0,0.5);
        }
        .memory-card .back {
            transform: rotateY(180deg);
            background-color: #ffffff;
        }
        .memory-card .back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }
        .memory-card.matched {
            transform: scale(0.95);
            opacity: 0.4;
            cursor: default;
        }
    </style>
</head>
<body class="text-gray-700">

    <div id="app-container" class="app-container max-w-md mx-auto min-h-screen p-4">

        <div id="menu-screen">
            <header class="text-center mb-6">
                <h1 class="text-4xl sm:text-5xl font-bold text-pink-500 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 sm:h-10 sm:w-10" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                    ‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏°‡πà‡∏≠‡∏ô
                </h1>
                <p class="text-pink-400 mt-1">‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
            </header>

            <div class="card mb-6">
                <h2 class="text-xl font-semibold mb-3 text-center text-gray-500">
                    <span class="inline-block align-middle">üí∞</span> ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô
                </h2>
                <div class="flex justify-around">
                    <div class="text-center">
                        <p class="text-3xl font-bold text-yellow-500" id="mon-coin-display">0</p>
                        <p class="text-sm font-medium text-gray-500">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡πà‡∏≠‡∏ô ($)</p>
                    </div>
                    <div class="text-center">
                        <p class="text-3xl font-bold text-green-500" id="play-coin-display">0</p>
                        <p class="text-sm font-medium text-gray-500">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏•‡πà‡∏ô‡∏°‡πà‡∏≠‡∏ô</p>
                    </div>
                </div>
            </div>

            <div id="inventory-card" class="card mb-6 hidden">
                   <h2 class="text-xl font-semibold mb-4 text-gray-500">
                     <span class="inline-block align-middle">üéí</span> ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </h2>
                <div id="inventory-list" class="space-y-2"></div>
            </div>

            <div class="card mb-6">
                <h2 class="text-xl font-semibold mb-3 text-gray-500">
                    <span class="inline-block align-middle">üóìÔ∏è</span> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                </h2>
                <button id="check-in-btn" class="btn btn-checkin">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                    ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (‡∏£‡∏±‡∏ö 5 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç)
                </button>
            </div>
            
            <div class="card mb-6">
                   <h2 class="text-xl font-semibold mb-4 text-gray-500">
                     <span class="inline-block align-middle">üéØ</span> ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                </h2>
                <div id="daily-missions-list" class="space-y-3"></div>
            </div>

            <div class="space-y-4">
                <button id="start-rps-game-btn" class="btn btn-play">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>
                    ‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö (‡πÉ‡∏ä‡πâ 1 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç)
                </button>
                <button id="start-memory-game-btn" class="btn btn-play-memory">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z" /></svg>
                    ‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏†‡∏≤‡∏û (‡πÉ‡∏ä‡πâ 1 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç)
                </button>
                <button id="go-to-shop-btn" class="btn btn-shop">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" /></svg>
                    ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á
                </button>
            </div>
        </div>

        <div id="shop-screen" class="hidden">
            <header class="flex items-center mb-6">
                <button id="shop-back-btn" class="text-3xl text-pink-500 hover:text-pink-600 transition">&larr;</button>
                <h1 class="text-3xl sm:text-4xl font-bold text-pink-500 ml-4">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏°‡πà‡∏≠‡∏ô</h1>
            </header>
            <div id="shop-items-list" class="space-y-4"></div>
        </div>

        <div id="rps-game-screen" class="hidden">
               <header class="flex items-center mb-4">
                 <button id="rps-game-back-btn" class="text-3xl text-pink-500 hover:text-pink-600 transition">&larr;</button>
                 <h1 class="text-3xl sm:text-4xl font-bold text-pink-500 ml-4">‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö!</h1>
            </header>
            <div class="card text-center mb-4">
                <p>‡∏ä‡∏ô‡∏∞‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á: <span id="rps-streak-counter" class="font-bold text-3xl text-green-500">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                <p class="mt-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ: <span id="rps-reward-counter" class="font-bold text-3xl text-yellow-500">1</span> $</p>
            </div>
            <div class="card mb-4">
                <p id="rps-result-text" class="text-center text-2xl font-semibold h-8 mb-4"></p>
                <div class="flex justify-around items-center">
                    <div class="text-center">
                        <p class="font-semibold mb-2 text-lg">‡∏Ñ‡∏∏‡∏ì</p>
                        <div id="rps-player-choice-display" class="w-24 h-24 sm:w-28 sm:h-28 bg-gray-200 rounded-2xl flex items-center justify-center text-gray-400 text-4xl shadow-inner">?</div>
                    </div>
                    <p class="text-4xl sm:text-5xl font-bold text-pink-400 animate-pulse">VS</p>
                    <div class="text-center">
                        <p class="font-semibold mb-2 text-lg">‡∏ö‡∏≠‡∏ó</p>
                        <div id="rps-bot-choice-display" class="w-24 h-24 sm:w-28 sm:h-28 bg-gray-200 rounded-2xl flex items-center justify-center text-gray-400 text-4xl shadow-inner">?</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <p class="text-center font-semibold mb-4 text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡∏¢!</p>
                <div class="flex justify-around gap-2">
                    <button class="game-choice-btn" data-choice="rock"><img src="rock.jpg" alt="‡∏Ñ‡πâ‡∏≠‡∏ô" class="w-20 h-20 sm:w-24 sm:h-24"></button>
                    <button class="game-choice-btn" data-choice="paper"><img src="paper.jpg" alt="‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©" class="w-20 h-20 sm:w-24 sm:h-24"></button>
                    <button class="game-choice-btn" data-choice="scissors"><img src="scissors.jpg" alt="‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£" class="w-20 h-20 sm:w-24 sm:h-24"></button>
                </div>
            </div>
        </div>

        <div id="memory-game-screen" class="hidden">
            <header class="flex items-center mb-2">
                <button id="memory-game-back-btn" class="text-3xl text-pink-500 hover:text-pink-600 transition">&larr;</button>
                <h1 class="text-2xl font-bold text-pink-500 ml-3">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏†‡∏≤‡∏û!</h1>
            </header>
            <div class="card text-center mb-2 p-3">
                <p>Level: <span id="memory-level" class="font-bold text-2xl text-purple-500">1</span></p>
                <p id="memory-peek-timer" class="mt-1 text-lg h-6"></p>
            </div>
            <div id="memory-grid-container" class="bg-white rounded-3xl shadow-lg p-2">
                <div id="memory-grid" class="memory-grid">
                    </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- STATE MANAGEMENT ---
            let state = {};

            const allMissions = [
                { text: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô', reward: 1 }, { text: '‡∏ñ‡πà‡∏≤‡∏¢ootd‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô', reward: 1 },
                { text: '‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å‡∏°‡πà‡∏≠‡∏ô', reward: 1 }, { text: '‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡∏°‡πà‡∏≠‡∏ô', reward: 1 },
                { text: '‡∏≠‡∏±‡∏î‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å‡∏°‡πà‡∏≠‡∏ô', reward: 1 }, { text: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏™‡πà‡∏á‡∏à‡∏∏‡πâ‡∏ö‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô', reward: 1 },
                { text: '‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô‡∏ü‡∏±‡∏á', reward: 1 }, { text: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô', reward: 1 },
                { text: '‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å', reward: 1 }, { text: '‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡πà‡∏≠‡∏ô‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á', reward: 1 },
            ];
            
            const shopItems = [
                { id: 'ticket_random', name: '‡∏ï‡∏±‡πã‡∏ß‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏á‡∏•‡πâ‡∏≠', price: 100 }, 
                { id: 'ticket_trip', name: '‡∏ï‡∏±‡πã‡∏ß‡πÉ‡∏´‡πâ‡∏û‡∏≤‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ', price: 300 },
                { id: 'ticket_wish', name: '‡∏ï‡∏±‡πã‡∏ß‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ', price: 1000 },
                { id: 'ticket_command', name: '‡∏ï‡∏±‡πã‡∏ß‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ', price: 500 },
            ];

            // --- DOM ELEMENTS ---
            const screens = {
                menu: document.getElementById('menu-screen'),
                rps: document.getElementById('rps-game-screen'),
                shop: document.getElementById('shop-screen'),
                memory: document.getElementById('memory-game-screen'),
            };
            const coinDisplays = {
                mon: document.getElementById('mon-coin-display'),
                play: document.getElementById('play-coin-display'),
            };
            const checkInBtn = document.getElementById('check-in-btn');
            const dailyMissionsList = document.getElementById('daily-missions-list');
            const shopItemsList = document.getElementById('shop-items-list');
            const inventoryCard = document.getElementById('inventory-card');
            const inventoryList = document.getElementById('inventory-list');
            
            // --- NAVIGATION BUTTONS ---
            const startRPSGameBtn = document.getElementById('start-rps-game-btn');
            const startMemoryGameBtn = document.getElementById('start-memory-game-btn');
            document.getElementById('go-to-shop-btn').addEventListener('click', () => showScreen('shop'));
            document.getElementById('rps-game-back-btn').addEventListener('click', () => showScreen('menu'));
            document.getElementById('shop-back-btn').addEventListener('click', () => showScreen('menu'));
            document.getElementById('memory-game-back-btn').addEventListener('click', () => showScreen('menu'));

            // --- RPS GAME ELEMENTS ---
            const rpsStreakCounter = document.getElementById('rps-streak-counter');
            const rpsRewardCounter = document.getElementById('rps-reward-counter');
            const rpsResultText = document.getElementById('rps-result-text');
            const rpsPlayerChoiceDisplay = document.getElementById('rps-player-choice-display');
            const rpsBotChoiceDisplay = document.getElementById('rps-bot-choice-display');
            const rpsChoiceBtns = document.querySelectorAll('.game-choice-btn');

            // --- MEMORY GAME ELEMENTS ---
            const memoryLevelDisplay = document.getElementById('memory-level');
            const memoryPeekTimerDisplay = document.getElementById('memory-peek-timer');
            const memoryGrid = document.getElementById('memory-grid');

            // --- LOCAL STORAGE ---
            function saveState() {
                localStorage.setItem('monGameDataV14', JSON.stringify(state));
            }

            function loadState() {
                const savedData = localStorage.getItem('monGameDataV14');
                if (savedData) {
                    state = JSON.parse(savedData);
                } else {
                    state = {
                        monCoins: 0, playCoins: 0, rpsStreak: 0,
                        lastCheckinDate: null, dailyMissions: [],
                        lastMissionDate: null, inventory: {}    
                    };
                    generateNewMissions();
                }
            }

            // --- UI UPDATE & NAVIGATION ---
            function updateCoinDisplays() {
                coinDisplays.mon.textContent = state.monCoins;
                coinDisplays.play.textContent = state.playCoins;
            }

            function showScreen(screenName) {
                Object.values(screens).forEach(s => s.classList.add('hidden'));
                screens[screenName].classList.remove('hidden');
            }
            
            function renderInventory() {
                inventoryList.innerHTML = '';
                const userItems = Object.keys(state.inventory).filter(key => state.inventory[key] > 0);

                if (userItems.length > 0) {
                    userItems.forEach(itemId => {
                        const itemDetails = shopItems.find(shopItem => shopItem.id === itemId);
                        if (itemDetails) {
                            const itemEl = document.createElement('div');
                            itemEl.className = 'bg-rose-100 p-3 rounded-lg flex justify-between items-center';
                            itemEl.innerHTML = `
                                <span class="font-medium text-rose-700">${itemDetails.name}</span>
                                <span class="font-bold text-white bg-rose-400 rounded-full px-3 py-1 text-sm">x${state.inventory[itemId]}</span>
                            `;
                            inventoryList.appendChild(itemEl);
                        }
                    });
                    inventoryCard.classList.remove('hidden');
                } else {
                    inventoryCard.classList.add('hidden');
                }
            }
            
            // --- CHECK-IN LOGIC ---
            function updateCheckInButton() {
                const today = new Date().toDateString();
                if (state.lastCheckinDate === today) {
                    checkInBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!`;
                    checkInBtn.disabled = true;
                    checkInBtn.classList.add('btn-disabled');
                } else {
                    checkInBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô (‡∏£‡∏±‡∏ö 5 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç)`;
                    checkInBtn.disabled = false;
                    checkInBtn.classList.remove('btn-disabled');
                }
            }
            
            checkInBtn.addEventListener('click', () => {
                const today = new Date().toDateString();
                if (state.lastCheckinDate !== today) {
                    state.playCoins += 5;
                    state.lastCheckinDate = today;
                    updateCoinDisplays();
                    updateCheckInButton();
                    saveState();
                    alert('‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 5 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏•‡πà‡∏ô‡∏°‡πà‡∏≠‡∏ô');
                }
            });

            // --- DAILY MISSIONS LOGIC ---
            function generateNewMissions() {
                const shuffled = [...allMissions].sort(() => 0.5 - Math.random());
                state.dailyMissions = shuffled.slice(0, 4).map(mission => ({ ...mission, completed: false }));
            }

            function renderMissions() {
                dailyMissionsList.innerHTML = '';
                state.dailyMissions.forEach((mission, index) => {
                    const missionEl = document.createElement('div');
                    missionEl.className = 'flex justify-between items-center bg-pink-100 p-3 rounded-xl border-l-4 border-pink-300';
                    const btnClass = mission.completed ? 'completed' : 'incomplete';
                    const btnContent = mission.completed 
                        ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg> ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`
                        : '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';

                    missionEl.innerHTML = `<p class="text-gray-600">${mission.text}</p><button data-index="${index}" class="mission-btn ${btnClass}">${btnContent}</button>`;
                    dailyMissionsList.appendChild(missionEl);
                });

                document.querySelectorAll('.mission-btn.incomplete').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = e.currentTarget.dataset.index;
                        const mission = state.dailyMissions[index];
                        if (!mission.completed) {
                            mission.completed = true;
                            state.playCoins += mission.reward;
                            updateCoinDisplays();
                            renderMissions();
                            saveState();
                        }
                    });
                });
            }

            // --- SHOP LOGIC ---
            function renderShopItems() {
                shopItemsList.innerHTML = '';
                shopItems.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'card flex justify-between items-center';
                    itemEl.innerHTML = `
                        <div>
                            <p class="font-semibold text-lg text-gray-700">${item.name}</p>
                            <p class="font-bold text-yellow-600">${item.price} $</p>
                        </div>
                        <button data-price="${item.price}" data-id="${item.id}" class="buy-item-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" /></svg>
                            ‡∏ã‡∏∑‡πâ‡∏≠
                        </button>`;
                    shopItemsList.appendChild(itemEl);
                });

                document.querySelectorAll('.buy-item-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const price = parseInt(e.currentTarget.dataset.price);
                        const itemId = e.currentTarget.dataset.id;
                        if (state.monCoins >= price) {
                            state.monCoins -= price;
                            state.inventory[itemId] = (state.inventory[itemId] || 0) + 1;
                            updateCoinDisplays();
                            renderInventory();
                            saveState();
                            alert('‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ï‡∏±‡πã‡∏ß‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞');
                        } else {
                            alert('‡∏≠‡∏∏‡πä‡∏¢! ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏à‡πâ‡∏≤!');
                        }
                    });
                });
            }

            // --- RPS GAME LOGIC ---
            function startRPSGame() {
                if (state.playCoins > 0) {
                    state.playCoins -= 1;
                    updateCoinDisplays();
                    saveState();
                    resetRPSGame();
                    showScreen('rps');
                } else {
                    alert('‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ "‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏•‡πà‡∏ô‡∏°‡πà‡∏≠‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ô‡∏∞');
                }
            }

            function resetRPSGame() {
                state.rpsStreak = 0;
                updateRPSGameUI();
                rpsResultText.textContent = '';
                rpsPlayerChoiceDisplay.innerHTML = '<span class="text-gray-400 text-4xl">?</span>';
                rpsBotChoiceDisplay.innerHTML = '<span class="text-4xl">?</span>';
                rpsChoiceBtns.forEach(b => b.classList.remove('selected'));
            }

            function updateRPSGameUI() {
                rpsStreakCounter.textContent = state.rpsStreak;
                const reward = state.rpsStreak === 0 ? 1 : Math.pow(2, state.rpsStreak);
                rpsRewardCounter.textContent = reward;
            }
            
            function handleRPSPlayerChoice(playerChoice) {
                const choices = ['rock', 'paper', 'scissors'];
                const botChoice = choices[Math.floor(Math.random() * choices.length)];

                const choiceImages = {
                    rock: 'rock.jpg',
                    paper: 'paper.jpg',
                    scissors: 'scissors.jpg'
                };
                rpsPlayerChoiceDisplay.innerHTML = `<img src="${choiceImages[playerChoice]}" class="w-full h-full object-cover rounded-2xl">`;
                rpsBotChoiceDisplay.innerHTML = `<img src="${choiceImages[botChoice]}" class="w-full h-full object-cover rounded-2xl">`;

                if (playerChoice === botChoice) {
                    rpsResultText.textContent = '‡πÄ‡∏™‡∏°‡∏≠‡∏à‡πâ‡∏≤!';
                } else if (
                    (playerChoice === 'rock' && botChoice === 'scissors') ||
                    (playerChoice === 'paper' && botChoice === 'rock') ||
                    (playerChoice === 'scissors' && botChoice === 'paper')
                ) {
                    const reward = state.rpsStreak === 0 ? 1 : Math.pow(2, state.rpsStreak);
                    state.monCoins += reward;
                    state.rpsStreak++;
                    rpsResultText.textContent = `‡∏ä‡∏ô‡∏∞! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${reward} $`;
                    updateRPSGameUI();
                    updateCoinDisplays();
                    saveState();
                } else {
                    const totalEarned = state.rpsStreak === 0 ? 0 : Array.from({length: state.rpsStreak}, (_, i) => i === 0 ? 1 : Math.pow(2, i)).reduce((a, b) => a + b, 0);
                    setTimeout(() => {
                        alert(`‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞‡∏Ñ‡∏∞! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalEarned} $ ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏∞ ${state.rpsStreak} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô`);
                        showScreen('menu');
                    }, 500);
                }
            }
            
            startRPSGameBtn.addEventListener('click', startRPSGame);

            rpsChoiceBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    rpsChoiceBtns.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    rpsResultText.textContent = '';
                    setTimeout(() => handleRPSPlayerChoice(btn.dataset.choice), 300);
                });
            });

            // --- MEMORY GAME LOGIC ---
            // Reduced to 4 unique images for easier levels (4 pairs = 8 cards)
            const easyMemoryImages = [
                '1.jpg', 
                '2.jpg',
                '3.jpg',
                '4.jpg',
            ];

            // Original 8 unique images for harder levels (8 pairs = 16 cards)
            const hardMemoryImages = [
                '1.jpg',
                '2.jpg',
                '3.jpg',
                '4.jpg',
                '5.jpg',
                '6.jpg',
                '7.jpg',
                '8.jpg',
            ];

            let memoryGameState = {};

            function startMemoryGame() {
                if (state.playCoins > 0) {
                    state.playCoins -= 1;
                    updateCoinDisplays();
                    saveState();
                    
                    memoryGameState = {
                        level: 1,
                        totalReward: 0,
                        cards: [],
                        flippedCards: [],
                        matchedPairs: 0,
                        canFlip: false,
                    };
                    
                    startMemoryLevel();
                    showScreen('memory');
                } else {
                    alert('‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ "‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÄ‡∏•‡πà‡∏ô‡∏°‡πà‡∏≠‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏ô‡∏∞');
                }
            }

            function startMemoryLevel() {
                memoryGameState.flippedCards = [];
                memoryGameState.matchedPairs = 0;
                memoryLevelDisplay.textContent = memoryGameState.level;
                
                // Peek time for levels 1, 2, 3, 4, 5+
                // Example: Level 1 (7s), Level 2 (6s), Level 3 (5s), Level 4 (4s), Level 5+ (3s)
                const peekTimes = [5, 5, 10, 8, 6]; 
                const peekTime = memoryGameState.level > peekTimes.length ? 3 : peekTimes[memoryGameState.level - 1];

                createMemoryBoard(); // Call createMemoryBoard without arguments
                
                let countdown = peekTime;
                memoryPeekTimerDisplay.textContent = `‡∏à‡∏≥‡∏†‡∏≤‡∏û‡πÉ‡∏ô ${countdown} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...`;
                const peekInterval = setInterval(() => {
                    countdown--;
                    memoryPeekTimerDisplay.textContent = `‡∏à‡∏≥‡∏†‡∏≤‡∏û‡πÉ‡∏ô ${countdown} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...`;
                    if (countdown <= 0) {
                        clearInterval(peekInterval);
                        memoryPeekTimerDisplay.textContent = '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ!';
                        memoryGameState.cards.forEach(card => card.classList.remove('flipped'));
                        memoryGameState.canFlip = true;
                    }
                }, 1000);
            }

            function createMemoryBoard() {
                let currentImages;
                let totalPairs;

                // Determine which set of images to use based on the current level
                if (memoryGameState.level <= 2) { // For Level 1 and 2
                    currentImages = [...easyMemoryImages];
                    totalPairs = easyMemoryImages.length;
                    memoryGrid.classList.add('small-grid'); // Add class for 2x4 grid
                } else { // For Level 3 and above
                    currentImages = [...hardMemoryImages];
                    totalPairs = hardMemoryImages.length;
                    memoryGrid.classList.remove('small-grid'); // Ensure it's back to 4x4
                }

                // Duplicate images for pairs and shuffle
                const cardImages = [...currentImages, ...currentImages];
                cardImages.sort(() => 0.5 - Math.random());    

                memoryGrid.innerHTML = '';
                memoryGameState.cards = [];
                memoryGameState.totalPairs = totalPairs; // Store total pairs for win condition check

                cardImages.forEach(imageSrc => {
                    const card = document.createElement('div');
                    card.className = 'memory-card flipped'; // Start flipped for peek time
                    card.dataset.image = imageSrc;

                    card.innerHTML = `
                        <div class="front">?</div>
                        <div class="back"><img src="${imageSrc}" alt="card"></div>
                    `;
                    card.addEventListener('click', () => handleCardClick(card));
                    memoryGrid.appendChild(card);
                    memoryGameState.cards.push(card);
                });
            }

            function handleCardClick(clickedCard) {
                if (!memoryGameState.canFlip || clickedCard.classList.contains('flipped') || clickedCard.classList.contains('matched')) {
                    return;
                }

                clickedCard.classList.add('flipped');
                memoryGameState.flippedCards.push(clickedCard);

                if (memoryGameState.flippedCards.length === 2) {
                    memoryGameState.canFlip = false;
                    checkForMatch();
                }
            }

            function checkForMatch() {
                const [cardOne, cardTwo] = memoryGameState.flippedCards;
                if (cardOne.dataset.image === cardTwo.dataset.image) {
                    cardOne.classList.add('matched');
                    cardTwo.classList.add('matched');
                    memoryGameState.matchedPairs++;
                    memoryGameState.flippedCards = [];
                    // Small delay before allowing next flip to make it feel natural
                    setTimeout(() => { memoryGameState.canFlip = true; }, 300); 
                    
                    if (memoryGameState.matchedPairs === memoryGameState.totalPairs) { // Check against dynamic totalPairs
                        const reward = Math.pow(2, memoryGameState.level - 1);
                        state.monCoins += reward;
                        memoryGameState.totalReward += reward;
                        updateCoinDisplays();
                        saveState();

                        alert(`‡∏ú‡πà‡∏≤‡∏ô Level ${memoryGameState.level}! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${reward} ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡πà‡∏≠‡∏ô`);
                        
                        memoryGameState.level++;
                        startMemoryLevel();
                    }
                } else {
                    // Mismatch: flip back cards after a delay
                    setTimeout(() => {
                        cardOne.classList.remove('flipped');
                        cardTwo.classList.remove('flipped');
                        memoryGameState.flippedCards = [];
                        memoryGameState.canFlip = true;
                    }, 1000); // Cards stay flipped for 1 second before flipping back
                    setTimeout(() => {
                        alert(`‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ú‡∏¥‡∏î! ‡πÄ‡∏Å‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${memoryGameState.totalReward} ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏°‡πà‡∏≠‡∏ô`);
                        showScreen('menu');
                    }, 1200); // Show alert after cards flip back
                }
            }

            startMemoryGameBtn.addEventListener('click', startMemoryGame);

            // --- INITIALIZATION ---
            function init() {
                loadState();
                const today = new Date().toDateString();
                if(state.lastMissionDate !== today) {
                    generateNewMissions();
                    state.lastMissionDate = today;
                    saveState();    
                }
                updateCoinDisplays();
                updateCheckInButton();
                renderMissions();
                renderShopItems();
                renderInventory();
                showScreen('menu');
            }

            init();
        });
    </script>
</body>
</html>